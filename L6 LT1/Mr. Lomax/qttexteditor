import PyQt6.QtWidgets as qtw
import PyQt6.QtCore as qtc
import PyQt6.QtGui as qtg

class MainWindow(qtw.QMainWindow):

    def __init__(self):
        super().__init__()


        self.setWindowTitle("Felipe's Cold Text Editor")

        self.layout = qtw.QFormLayout()

        self.title = qtw.QLabel("No file opened yet")

        self.textEdit = qtw.QTextEdit()


        self.button1 = qtw.QPushButton("Open")
        self.button1.clicked.connect(self.open_btn_click)#

        self.button2 = qtw.QPushButton("Save")
        self.button2.clicked.connect(self.save_btn_click)

        self.button3 = qtw.QPushButton("Exit")
        self.button3.clicked.connect(self.exit_btn_click)

        self.layout.addRow(self.title)
        self.layout.addRow(self.button3)
        self.layout.addRow(self.button1)
        #layout.addRow(self.button2)

        widget = qtw.QWidget()
        widget.setLayout(self.layout)
        
        self.setCentralWidget(widget)

    def open_btn_click(self):
        self.filename, _ = qtw.QFileDialog.getOpenFileName(self, "Open File", ".", "Text Files (*.txt *.html)")
        self.title.setText(self.filename)

        self.layout.addRow(self.button2)
        self.layout.addRow(self.textEdit)

        with open(self.filename, 'r') as file:
            text = file.read()
        self.textEdit.setPlainText(text)

    def save_btn_click(self):
        #filename, _ = qtw.QFileDialog.getSaveFileName(self, "Save File", ".", "Text Files (*.txt *.html)")

        with open(self.filename, 'w') as file:
            file.write(self.textEdit.toPlainText())

    def exit_btn_click(self):
        saved = False
        with open(self.filename, 'r') as file:
            file_text = file.read()
            editor_text = self.textEdit.toPlainText()
            if file_text == editor_text:
                saved = True

        if saved == False: 
            dlg = qtw.QMessageBox.warning(self, "Exit", "Close editor?\nAny unsaved changes will be lost", qtw.QMessageBox.StandardButton.Ok | qtw.QMessageBox.StandardButton.Cancel)
            if dlg == qtw.QMessageBox.StandardButton.Ok:
                qtw.QApplication.quit()
        
        else:
            qtw.QApplication.quit()
 
    


app = qtw.QApplication([])

window = MainWindow()
window.show()

app.exec()